<%- include('cabecalho') -%>

<style>
  html, body {
    overflow: auto !important;
    height: auto !important;
    min-height: 100% !important;
    position: relative !important;
  }
</style>

<body>
<section id="portfolio" class="portfolio h-100" style="background-color: #b56e56;">
  <div class="container py-5">
    <div class="row d-flex justify-content-center align-items-center">
      <div class="col col-lg-9 col-xl-7">
        <div class="card">

          <% if (!usuario) { %>
            <div class="p-5 text-center">
              <h4>‚ö† Usu√°rio n√£o encontrado</h4>
              <a href="/" class="btn btn-primary">Voltar</a>
            </div>

          <% } else { %>

            <!-- HEADER PERFIL -->
            <div class="rounded-top text-white d-flex flex-row position-relative" style="background:#000; height:200px;">
              <div class="ms-4 mt-5 d-flex flex-column" style="width:150px; z-index:2;">
                <img src="/assets/fotos/<%= usuario.foto || 'default.png' %>?v=<%= Date.now() %>"
                     class="img-fluid img-thumbnail"
                     style="width:140px; height:210px; object-fit:cover; border-radius:10px; position:relative;">
              </div>

              <div class="ms-3" style="margin-top:130px;">
                <h5><%= usuario.nome1 || '' %> <%= usuario.nome2 || '' %></h5>
                <p><%= usuario.username || '' %></p>
              </div>
            </div>

            <!-- STATS -->
            <div class="p-4 text-black">
              <div class="d-flex justify-content-end text-center">
                <div>
                  <p class="mb-0 h5"><%= Array.isArray(materiais) ? materiais.length : 0 %></p>
                  <p class="small text-muted">Materiais</p>
                </div>
              </div>
            </div>

            <!-- DESCRI√á√ÉO -->
            <div class="card-body p-4 text-black">
              <p class="lead fw-normal mb-1">Descri√ß√£o</p>
              <div class="p-3 bg-light rounded">
                <p class="mb-1"><%= usuario.cidade || 'Sem cidade' %></p>
                <p class="mb-1"><%= usuario.profissao || 'Sem profiss√£o' %></p>
                <p class="mb-0"><%= usuario.telefone || 'Sem telefone' %></p>
              </div>
            </div>

            <!-- LISTA MATERIAIS -->
            <div class="card-body p-4 text-black">
              <p class="lead fw-normal mb-3">Materiais enviados</p>

              <% if (!materiais || materiais.length === 0) { %>
                <p class="text-muted">Este usu√°rio ainda n√£o enviou materiais.</p>
              <% } else { %>
                <% materiais.forEach(item => { %>
                  <div class="p-3 border rounded bg-light mb-3 shadow-sm">
                    <h5><%= item.titulo %></h5>
                    <p class="text-muted"><%= item.conteudo %></p>
                    <p class="small">üìò Disciplina: <%= item.disciplina?.titulo || 'Sem disciplina' %></p>

                    <% const arquivo = (item.material || '').toLowerCase(); %>
                    <% if (arquivo.endsWith('.pdf')) { %>
                      <img src="/assets/img/pdf-icon.png" width="60">
                    <% } else { %>
                      <img src="/assets/img/ppt-icon.png" width="60">
                    <% } %>

                    <div class="mt-2 d-flex gap-2">
                      <a href="/material/download/<%= item._id %>" class="btn btn-success btn-sm">Baixar</a>
                      <a href="/assets/fotos/<%= item.material %>" target="_blank" class="btn btn-secondary btn-sm">Visualizar</a>
                    </div>
                  </div>
                <% }) %>
              <% } %>
            </div>

          <% } %>

        </div>
      </div>
    </div>
  </div>
</section>

<%- include('rodape') -%>
