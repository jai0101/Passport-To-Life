<%- include('cabecalho') -%>

<style>
  html, body {
    overflow-y: auto !important;
    height: 100%;
    margin: 0;
    padding: 0;
  }

  #portfolio {
    min-height: 100vh;
    overflow-y: auto;
    padding-bottom: 80px;
  }
</style>

<section id="portfolio" class="portfolio" style="background-color: #b56e56;"> 
  <div class="container py-5">

    <!-- Cabeçalho -->
    <table class="table table-borderless" style="color:#fffcf7;">
      <tr>
        <th>
          <p style="color:#fffcf7; font-size: 24px;">Usuários</p>

          <!-- Barra de pesquisa -->
          <input type="text" id="pesquisaUsuario" class="form-control mt-2" 
                 placeholder="Pesquisar por nome ou sobrenome" style="max-width: 542px;">
        </th>
      </tr>
    </table>

    <% if (!usuarios || usuarios.length === 0) { %>
      <p class="text-white mt-3">Nenhum usuário encontrado.</p>
    <% } else { %>
      <table class="table table-borderless mt-3" id="tabelaUsuarios">
        <% usuarios.forEach(usuario => { %>
          <tr class="usuario-linha">
            <td>
              <div class="col col-md-9 col-lg-7 col-xl-5">
                <div class="card mb-4" style="border-radius: 15px;">
                  <div class="card-body p-4">
                    <div class="d-flex text-black">

                      <!-- FOTO DO USUÁRIO -->
                      <div class="flex-shrink-0">
                        <img src="/assets/fotos/<%= usuario.foto || 'default.png' %>" 
                             alt="Foto de <%= usuario.nome1 %>" 
                             class="img-fluid" 
                             style="width: 180px; height: 270px; border-radius: 10px; object-fit: cover;">
                      </div>

                      <!-- INFO DO USUÁRIO -->
                      <div class="flex-grow-1 ms-3">
                        <p class="mb-2 pb-1 nomeUsuario" 
                           style="color: #2b2a2a; font-weight: bold; font-size: 1.3rem;">
                          <%= usuario.nome1 %> <%= usuario.nome2 %>
                        </p>
                        <h5 class="mb-2"><%= usuario.profissao || "Sem profissão informada" %></h5>

                        <!-- QUANTIDADE DE MATERIAIS -->
                        <div class="d-flex justify-content-start rounded-3 p-2 mb-2" style="background-color: #efefef;">
                          <div>
                            <p class="small text-muted mb-1">Materiais</p>
                            <p class="mb-0"><%= usuario.quantidadeConteudos ?? 0 %></p>
                          </div>
                        </div>

                        <!-- BOTÃO PERFIL -->
                        <div class="d-flex pt-1">
                          <a href="/usuario/<%= usuario._id %>">
                            <button type="button" class="btn btn-outline-primary me-1 flex-grow-1">
                              Ver Perfil
                            </button>
                          </a>
                        </div>

                      </div> <!-- fim info -->
                    </div> <!-- fim d-flex -->
                  </div> <!-- fim card-body -->
                </div> <!-- fim card -->
              </div> <!-- fim col -->
            </td>
          </tr>
        <% }) %>
      </table>
    <% } %>

  </div>
</section>

<%- include('rodape') -%>

<script>
  // Pesquisa por nome em tempo real
  const inputPesquisa = document.getElementById('pesquisaUsuario');
  inputPesquisa.addEventListener('keyup', function() {
    const filtro = inputPesquisa.value.toLowerCase();
    const linhas = document.querySelectorAll('.usuario-linha');

    linhas.forEach(linha => {
      const nome = linha.querySelector('.nomeUsuario').textContent.toLowerCase();
      linha.style.display = nome.includes(filtro) ? '' : 'none';
    });
  });
</script>
