<%- include('cabecalho') -%>

<style>
  html, body {
    overflow: auto !important;
    height: auto !important;
    min-height: 100% !important;
    position: relative !important;
  }

  .btn-editar {
    border: 2px solid black;
    background-color: white;
    color: black;
    font-weight: 600;
    transition: 0.3s;
  }
  .btn-editar:hover {
    background-color: black;
    color: white;
  }
  .btn-excluir {
    border: 2px solid #dc3545;
    background-color: white;
    color: #dc3545;
    font-weight: 600;
    transition: 0.3s;
  }
  .btn-excluir:hover {
    background-color: #dc3545;
    color: white;
  }
  .btn-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
  }
  .descricao-titulo {
    margin-top: 30px;
    font-weight: 600;
  }
  .iframe-container {
    margin-top: 10px;
    width: 100%;
    height: 300px; /* menor tamanho */
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  .material-box {
    display: flex;
    align-items: flex-start;
    gap: 15px;
  }
  .material-info {
    flex: 1;
  }
</style>

<body>
<section id="portfolio" class="portfolio h-100" style="background-color: #b56e56;">
  <div class="container py-5">
    <div class="row d-flex justify-content-center align-items-center">
      <div class="col col-lg-9 col-xl-7">
        <div class="card">

          <% if (!Admin) { %>
            <div class="p-5 text-center">
              <h4>âš  VocÃª nÃ£o estÃ¡ logado</h4>
              <p>FaÃ§a login para acessar seu perfil.</p>
              <a href="/login" class="btn btn-primary">Ir para o login</a>
            </div>
          <% } else { %>

            <!-- HEADER PERFIL -->
            <div class="rounded-top text-white d-flex flex-row position-relative" style="background:#000; height:200px;">
              <div class="ms-4 mt-5 d-flex flex-column" style="width:150px; z-index:2;">
                <img src="/assets/fotos/<%= Admin.foto || 'default.png' %>?v=<%= Date.now() %>"
                     class="img-fluid img-thumbnail"
                     style="width:140px; height:210px; object-fit:cover; border-radius:10px; position:relative;">
                <div class="btn-container">
                  <a href="/editar/<%= Admin._id %>" class="btn btn-editar btn-sm">Editar</a>
                  <a href="/excluir/<%= Admin._id %>" class="btn btn-excluir btn-sm"
                     onclick="return confirm('Tem certeza que deseja excluir seu perfil? Esta aÃ§Ã£o Ã© irreversÃ­vel.');">
                     Excluir
                  </a>
                </div>
              </div>

              <div class="ms-3" style="margin-top:130px;">
                <h5><%= Admin.nome1 || '' %> <%= Admin.nome2 || '' %></h5>
                <p><%= Admin.username || '' %></p>
              </div>
            </div>

            <!-- STATS -->
            <div class="p-4 text-black">
              <div class="d-flex justify-content-end text-center">
                <div>
                  <p class="mb-0 h5"><%= Array.isArray(materiais) ? materiais.length : 0 %></p>
                  <p class="small text-muted">Materiais</p>
                </div>
              </div>
            </div>

            <!-- DESCRIÃ‡ÃƒO -->
            <div class="card-body p-4 text-black">
              <p class="lead fw-normal mb-1 descricao-titulo">DescriÃ§Ã£o</p>
              <div class="p-3 bg-light rounded">
                <p class="mb-1"><%= Admin.cidade || 'Sem cidade' %></p>
                <p class="mb-1"><%= Admin.profissao || 'Sem profissÃ£o' %></p>
                <p class="mb-0"><%= Admin.telefone || 'Sem telefone' %></p>
              </div>
            </div>

            <!-- FORM UPLOAD -->
            <div class="card-body p-4 text-black">
              <p class="lead fw-normal mb-3">Enviar novo material</p>
              <form action="/disciplina/upload" method="POST" enctype="multipart/form-data" class="p-3 border rounded bg-light shadow-sm">
                <div class="mb-2">
                  <label class="form-label"><strong>TÃ­tulo</strong></label>
                  <input type="text" name="titulo" class="form-control" required>
                </div>
                <div class="mb-2">
                  <label class="form-label"><strong>DescriÃ§Ã£o</strong></label>
                  <textarea name="conteudo" class="form-control" rows="2" required></textarea>
                </div>
                <div class="mb-2">
                  <label class="form-label"><strong>Disciplina</strong></label>
                  <select name="disciplina" class="form-select" required>
                    <option value="">Selecione...</option>
                    <% if (disciplinasDisponiveis && disciplinasDisponiveis.length > 0) { %>
                      <% disciplinasDisponiveis.forEach(d => { %>
                        <option value="<%= d._id %>"><%= d.titulo %></option>
                      <% }) %>
                    <% } else { %>
                      <option disabled>Nenhuma disciplina cadastrada</option>
                    <% } %>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label"><strong>Arquivo (PDF ou PPT)</strong></label>
                  <input type="file" name="material" class="form-control" accept=".pdf,.ppt,.pptx" required>
                </div>
                <button type="submit" class="btn btn-success w-100">ðŸ“¤ Enviar Material</button>
              </form>
            </div>

            <!-- LISTA MATERIAIS -->
            <div class="card-body p-4 text-black">
              <p class="lead fw-normal mb-3">Seus Materiais</p>

              <% if (!materiais || materiais.length === 0) { %>
                <p class="text-muted">Nenhum material enviado.</p>
              <% } else { %>
                <% materiais.forEach(item => { %>
                  <div class="p-3 border rounded bg-light mb-3 shadow-sm">
                    <div class="material-box">
                      <% if (item.material) { %>
                        <% const arquivo = item.material.toLowerCase(); %>
                        <% if (arquivo.endsWith('.pdf')) { %>
                          <img src="/assets/img/pdf-icon.png" width="60" class="me-2">
                        <% } else if (arquivo.endsWith('.ppt') || arquivo.endsWith('.pptx')) { %>
                          <img src="/assets/img/ppt-icon.png" width="60" class="me-2">
                        <% } else { %>
                          <span>Arquivo invÃ¡lido</span>
                        <% } %>
                      <% } %>

                      <div class="material-info">
                        <h5><%= item.titulo %></h5>
                        <p class="small text-muted">ðŸ“˜ Disciplina: <%= item.disciplina?.titulo || 'Sem disciplina' %></p>
                      </div>
                    </div>

                    <!-- IFRAME DE VISUALIZAÃ‡ÃƒO -->
                    <% if (item.material) { %>
                      <iframe src="/material/visualizar/<%= item._id %>" class="iframe-container"></iframe>
                    <% } %>

                    <!-- BOTÃ•ES -->
                    <div class="mt-2 d-flex gap-2">
                      <a href="/material/download/<%= item._id %>" class="btn btn-success btn-sm">Baixar</a>
                      <a href="/material/visualizar/<%= item._id %>" target="_blank" class="btn btn-primary btn-sm">Visualizar</a>
                      <a href="/excluir/material/<%= item._id %>" 
                         class="btn btn-danger btn-sm"
                         onclick="return confirm('Deseja excluir este material?');">Excluir</a>
                    </div>
                  </div>
                <% }) %>
              <% } %>
            </div>

          <% } %> <!-- fecha else -->
        </div>
      </div>
    </div>
  </div>
</section>

<%- include('rodape') -%>
